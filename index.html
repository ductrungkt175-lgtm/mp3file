<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Ph√°t MP3 t·ª± ƒë·ªông</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      text-align: center;
    }
    .player-container {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background: #0056b3;
    }
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    .status {
      margin: 10px 0;
      padding: 10px;
      border-radius: 5px;
    }
    .success { background: #d4edda; color: #155724; }
    .warning { background: #fff3cd; color: #856404; }
    .error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <h2>üéµ Ph√°t file MP3 t·ª± ƒë·ªông</h2>
  
  <div class="player-container">
    <p id="info"></p>
    
    <div id="status" class="status"></div>

    <audio id="player" autoplay muted playsinline>
      <source id="source" type="audio/mpeg">
      Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph√°t audio.
    </audio>

    <div>
      <button id="unmuteBtn" disabled>üîá B·∫≠t ti·∫øng</button>
      <button id="playBtn" style="display:none;">‚ñ∂Ô∏è Ph√°t l·∫°i</button>
    </div>
  </div>

  <script>
    // L·∫•y t√™n file t·ª´ URL (v√≠ d·ª•: ?file=pencil.mp3)
    const params = new URLSearchParams(window.location.search);
    const file = params.get("file");

    const info = document.getElementById("info");
    const status = document.getElementById("status");
    const source = document.getElementById("source");
    const player = document.getElementById("player");
    const unmuteBtn = document.getElementById("unmuteBtn");
    const playBtn = document.getElementById("playBtn");

    if (file) {
      // S·ª¨A L·ªñI 404: S·ª≠a ƒë∆∞·ªùng d·∫´n file
      source.src = file; // File n·∫±m c√πng th∆∞ m·ª•c v·ªõi index.html
      info.textContent = "ƒêang ph√°t: " + file;
      
      status.textContent = "ƒêang t·∫£i file...";
      status.className = "status warning";

      player.load();

      // Th·ª≠ autoplay v·ªõi muted (ƒë∆∞·ª£c ph√©p)
      player.play().then(() => {
        status.textContent = "‚úÖ ƒêang ph√°t nh·∫°c (t·∫°m t·∫Øt ti·∫øng)";
        status.className = "status success";
        unmuteBtn.disabled = false;
        unmuteBtn.textContent = "üîá B·∫≠t ti·∫øng";
        
        console.log("Autoplay v·ªõi muted th√†nh c√¥ng");
      }).catch(err => {
        console.warn("Tr√¨nh duy·ªát ch·∫∑n autoplay:", err);
        status.textContent = "‚ùå Kh√¥ng th·ªÉ t·ª± ƒë·ªông ph√°t. Vui l√≤ng nh·∫•n n√∫t Ph√°t l·∫°i.";
        status.className = "status error";
        playBtn.style.display = "inline-block";
      });

      // S·ª± ki·ªán khi audio c√≥ th·ªÉ ph√°t ƒë∆∞·ª£c
      player.addEventListener('canplay', function() {
        console.log("Audio ready to play");
      });

      // S·ª± ki·ªán khi c√≥ l·ªói t·∫£i file
      player.addEventListener('error', function(e) {
        console.error("L·ªói t·∫£i file:", e);
        status.textContent = "‚ùå L·ªói t·∫£i file: " + file;
        status.className = "status error";
      });

    } else {
      info.textContent = "Kh√¥ng c√≥ file ƒë∆∞·ª£c ch·ªçn";
      status.textContent = "Vui l√≤ng th√™m ?file=t√™n_file.mp3 v√†o URL (v√≠ d·ª•: ?file=pencil.mp3)";
      status.className = "status warning";
    }

    // N√∫t b·∫≠t ti·∫øng
    unmuteBtn.addEventListener('click', function() {
      player.muted = false;
      unmuteBtn.textContent = "üîä ƒê√£ b·∫≠t ti·∫øng";
      unmuteBtn.disabled = true;
      status.textContent = "‚úÖ ƒêang ph√°t v·ªõi √¢m thanh";
      status.className = "status success";
    });

    // N√∫t ph√°t l·∫°i
    playBtn.addEventListener('click', function() {
      player.play().then(() => {
        status.textContent = "‚úÖ ƒêang ph√°t nh·∫°c";
        status.className = "status success";
        playBtn.style.display = "none";
      }).catch(err => {
        status.textContent = "‚ùå L·ªói ph√°t nh·∫°c: " + err.message;
        status.className = "status error";
      });
    });

    // Hi·ªÉn th·ªã n√∫t ph√°t l·∫°i khi audio k·∫øt th√∫c
    player.addEventListener('ended', function() {
      playBtn.style.display = "inline-block";
    });
  </script>
</body>
</html>
